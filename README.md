# `multi`

Multi is a decentralized currency backed by a diversified reserve of tokens, designed to set a new standard for value and stability in the Web3 ecosystem. It achieves this through a unique governance model that incentivizes participants to bet on the long-term performance of tokens, rather than relying on community consensus. This fosters a resilient and adaptive currency design that leverages collective wisdom, allowing anyone to directly contribute their insights. Multi is traded with its underlying reserve tokens in an order book market, with a built-in algorithm that enhances liquidity and market stability.

## Testing Setup

### Unit Tests (Motoko)
The project uses Motoko unit tests with the `motoko-matchers` package. Unit tests can be found in `src/tests/unit/`.

To run unit tests:
```bash
dfx deploy multi_test
dfx canister call multi_test run
```

Test output will be visible in the dfx console logs.

### End-to-End Tests (TypeScript)
E2E tests are written in TypeScript using Vitest and test the canister through its public interface.

To run e2e tests:
```bash
npm test
```

## Running the project locally

If you want to test your project locally, you can use the following commands:

```bash
# Starts the replica, running in the background
dfx start --background

# Deploys your canisters to the replica and generates your candid interface
dfx deploy
```

Once the job completes, your application will be available at `http://localhost:4943?canisterId={asset_canister_id}`.

## Development Workflow

1. **Making Backend Changes**
   - Edit Motoko files in `src/multi_backend/`
   - Run `dfx deploy` to deploy changes
   - Run both unit and e2e tests to verify changes

2. **Adding Tests**
   - For unit tests: Add test cases to `src/tests/unit/test.mo`
   - For e2e tests: Add test cases to `src/tests/e2e/e2e_tests_backend.test.ts`

## Package Management
This project uses Mops for Motoko package management:

```bash
# Add a package
mops add <package-name>

# Install packages
mops install
```

## Useful Resources

- [Quick Start](https://internetcomputer.org/docs/current/developer-docs/setup/deploy-locally)
- [SDK Developer Tools](https://internetcomputer.org/docs/current/developer-docs/setup/install)
- [Motoko Programming Language Guide](https://internetcomputer.org/docs/current/motoko/main/motoko)
- [Motoko Language Quick Reference](https://internetcomputer.org/docs/current/motoko/main/language-manual)
- [Motoko Testing Guide](https://internetcomputer.org/docs/current/developer-docs/build/languages/motoko/testing)

## Commands Reference

```bash
# Development
dfx start --background      # Start the local replica
dfx deploy                 # Deploy all canisters
npm run generate          # Generate candid interface

# Testing
dfx deploy multi_test     # Deploy and run Motoko unit tests
npm test                 # Run e2e tests

# Package Management
mops add <package>       # Add a new package
mops install            # Install all packages
```

### Note on frontend environment variables

If you are hosting frontend code somewhere without using DFX, you may need to make one of the following adjustments to ensure your project does not fetch the root key in production:

- set`DFX_NETWORK` to `ic` if you are using Webpack
- use your own preferred method to replace `process.env.DFX_NETWORK` in the autogenerated declarations
  - Setting `canisters -> {asset_canister_id} -> declarations -> env_override to a string` in `dfx.json` will replace `process.env.DFX_NETWORK` with the string in the autogenerated declarations
- Write your own `createActor` constructor